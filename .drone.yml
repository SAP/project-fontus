---
kind: pipeline
name: default

steps:
  - name: unit_tests
    image: ubuntu:19.10
    commands:
      - DEBIAN_FRONTEND=noninteractive apt-get update && apt-get install -y python3 openjdk-11-jdk-headless && rm -rf /var/lib/apt/lists/*
      - ./gradlew -s check

  - name: system_tests
    image: ubuntu:19.10
    commands:
      - DEBIAN_FRONTEND=noninteractive apt-get update && apt-get install -y python3 openjdk-11-jdk-headless && rm -rf /var/lib/apt/lists/*
      - ./gradlew -s assemble
      - ./gradlew -s jar
      - ./gradlew -s check
      - ./gradlew publishToMavenLocal
      - cd tests
      - chmod +x run_system_tests.py
      - cd jars
      - bash build.sh
      - cd ..
      - python3 ./run_system_tests.py --build-first
